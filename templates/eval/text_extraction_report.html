{% extends "eval/base.html" %}
{% block title %}Text Extraction Evaluation Report <span class="float-right ml-2 px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded-full">{{ (score * 100) | round | int }}%</span>{% endblock %}

{% block content %}
{% for result in results %}
    <div class="bg-white rounded border mb-6 overflow-hidden">
        <!-- Page ID header -->
        <div class="bg-gray-600 text-white px-4 py-3 font-bold text-xl flex justify-between items-center">
            <span>Page Test {{result.step}}</span>
            <div class="flex gap-2">
                <span class="px-3 py-1 bg-gray-700 text-white text-sm font-medium rounded-full"><a href="{{ result.label_studio_url }}" target="_blank">{{ result.id }}</a></span>
                <span class="px-3 py-1 bg-blue-600 text-white text-sm font-medium rounded-full">{{ (result.score * 100) | round | int}}%</span>
            </div>
        </div>
        
        <div class="flex gap-4 mb-6 pt-4 px-4">
            <div class="flex-shrink-0">
                <a href="{{ result.page_image_path }}" target="_blank" class="block">
                    <img src="{{ result.page_image_path }}" class="h-auto max-h-[150px] border rounded shadow-sm hover:shadow-md transition-shadow" alt="Page {{ result.page_id }}">
                </a>
            </div>
            <div class="flex-1">
                <div class="text-sm text-gray-600 max-h-96 overflow-y-auto">
                    {{ result.page_text }}
                </div>
            </div>
        </div>

        <!-- Results header -->
        <div class="bg-gray-700 text-white px-4 py-2 font-medium">
            <div class="grid gap-4 px-2" style="grid-template-columns: 16fr 3fr 3fr;">
                <div>Evaluation Results</div>
                <div class="px-2 text-right text-sm">Expected</div>
                <div class="px-2 text-right text-sm">Actual</div>
            </div>
        </div>
        
        {% for match in result.matches %}
        <div class="grid gap-4 px-2 hover:bg-gray-50 items-center mx-4" style="grid-template-columns: 16fr 3fr 3fr;">
            <div class="text-sm text-gray-700 py-1">{{ match.text }}</div>
            <div class="text-right">
                <span class="px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded">{{ match.expected }}</span>
            </div>
            <div class="text-right">
                {% if match.expected == match.actual %}
                <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded">{{ match.actual }}</span>
                {% else %}
                <span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded">{{ match.actual }}</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        <!-- Reasoning section -->
        {% if result.page_texts.reasoning %}
        <div class="bg-blue-50 mt-4 p-4 border-t border-blue-200 text-sm text-blue-800 italic">
            <span class="float-right ml-2 px-2 py-1 bg-blue-600 text-white text-xs font-semibold rounded">reasoning</span>
            {{ result.page_texts.reasoning }}
            <div class="clear-both"></div>
        </div>
        {% endif %}
    </div>
{% endfor %}

{% endblock %}