<div class="container content mx-auto w-full min-h-screen px-8 py-8 flex items-center justify-center" id="content" style="background-color: {{ section.background_color }};">
    <section id="simple-main" role="article" data-section-type="{{ section.section_type.name }}" data-id="{{ section.section_id }}" {% if section.explanation_id %}data-eli5-id="{{ section.explanation_id }}"{% endif %}>
        <div class="flex flex-col lg:flex-row px-8 items-start max-w-none w-full gap-8">
                    {% set counts = namespace(img=0, text=0) %}
                    {% for pid in section.part_ids %}
                        {% if images[pid] %}
                            {% set counts.img = counts.img + 1 %}
                        {% else %}
                            {% set counts.text = counts.text + 1 %}
                        {% endif %}
                    {% endfor %}

                    {% if counts.img == 0 and counts.text >= 2 %}
                    {# Text-only page with multiple groups: split into two balanced columns by line count #}
                    {% set acc = namespace(total=0) %}
                    {% for pid in section.part_ids %}
                        {% if not images[pid] %}
                            {% set acc.total = acc.total + (groups[pid].texts | length) %}
                        {% endif %}
                    {% endfor %}
                    {% set half = (acc.total + 1) // 2 %}

                    {# Left column: render groups until cumulative lines reach half #}
                    {% set ns = namespace(cum=0) %}
                    <div class="basis-full lg:basis-1/2 p-4 flex flex-col" style="color: {{ section.text_color }};">
                        {% for part in section.part_ids %}
                        {% if not images[part] %}
                            {% set group_lines = groups[part].texts | length %}
                            {% if ns.cum < half %}
                                    <p class="mb-8 w-full">
                                {# Determine text size based on total characters in the group #}
                                {% set total_text_length = 0 %}
                                {% for text_part in groups[part].texts %}
                                    {% set total_text_length = total_text_length + text_part.text | length %}
                                {% endfor %}
                                {% set text_size_class = "text-lg lg:text-xl" if total_text_length > 300 else "text-2xl lg:text-3xl" %}

                                {% set line_style = "inline" %}
                                {% if groups[part].group_type in ["stanza", "list"] %}
                                    {% set line_style = "block" %}
                                {% endif %}

                                {% for text in groups[part].texts %}
                                <span class="{{ text_size_class }} {{ line_style }} leading-relaxed font-normal" data-id="{{ part }}">{{ text.text }}</span>
                                {% endfor %}
                            </p>
                            {% set ns.cum = ns.cum + group_lines %}
                            {% endif %}
                        {% endif %}
                        {% endfor %}
                    </div>

                    {# Right column: render remaining groups #}
                    {% set ns2 = namespace(cum=0) %}
                    <div class="basis-full lg:basis-1/2 p-4 flex flex-col" style="color: {{ section.text_color }};">
                        {% for part in section.part_ids %}
                        {% if not images[part] %}
                            {% set group_lines = groups[part].texts | length %}
                            {% if ns2.cum < half %}
                                {% set ns2.cum = ns2.cum + group_lines %}
                            {% else %}
                                <p class="mb-8 w-full">
                                {# Determine text size based on total characters in the group #}
                                {% set total_text_length = 0 %}
                                {% for text_part in groups[part].texts %}
                                    {% set total_text_length = total_text_length + text_part.text | length %}
                                {% endfor %}
                                {% set text_size_class = "text-lg lg:text-xl" if total_text_length > 300 else "text-2xl lg:text-3xl" %}

                                {% set line_style = "inline" %}
                                {% if groups[part].group_type in ["stanza", "list"] %}
                                    {% set line_style = "block" %}
                                {% endif %}

                                {% for text in groups[part].texts %}
                                <span class="{{ text_size_class }} {{ line_style }} leading-relaxed font-normal" data-id="{{ part }}">{{ text.text }}</span>
                                {% endfor %}
                            </p>
                            {% endif %}
                        {% endif %}
                        {% endfor %}
                    </div>

                    {% elif counts.img == 2 and counts.text == 0 %}
                    <!-- Exactly two images: render side-by-side columns -->
                    <div class="basis-full lg:basis-1/2 p-4 flex flex-col" style="color: {{ section.text_color }};">
                        {% set left = section.part_ids[0] %}
                        <img class="mb-8 w-full rounded-lg" data-id="{{ left }}" style="max-height: 80vh; object-fit: contain;"></img>
                    </div>
                    <div class="basis-full lg:basis-1/2 p-4 flex flex-col" style="color: {{ section.text_color }};">
                        {% set right = section.part_ids[1] %}
                        <img class="mb-8 w-full rounded-lg" data-id="{{ right }}" style="max-height: 80vh; object-fit: contain;"></img>
                    </div>
                    {% else %}
                    <!-- Single column layout for image-only or text-only pages -->
                    <div class="basis-full p-4 flex flex-col" style="color: {{ section.text_color }};">
                        {% for part in section.part_ids %}
                        {% if images[part] %}
                        <img class="mb-8 w-full rounded-lg" data-id="{{ part }}" style="max-height: 80vh; object-fit: contain;"></img>
                        {% else %}                        
                        <!-- Calculate total text length for single column text -->
                        {% set total_text_length = 0 %}
                        {% for text_part in groups[part].texts %}
                            {% set total_text_length = total_text_length + text_part.text|length %}
                        {% endfor %}
                        
                        <!-- Use smaller text if total text length exceeds 300 characters -->
                        {% set text_size_class = "text-lg lg:text-xl" if total_text_length > 300 else "text-2xl lg:text-3xl" %}
                        
                        {% with line_style = "inline" %}
                        {% if groups[part].group_type in ["stanza", "list"] %}                            
                        {% set line_style = "block" %}
                        {% endif %}

                        {% for text in groups[part].texts %}
                        <span class="mb-8 {{ text_size_class }} {{ line_style }} leading-relaxed text-center font-normal max-w-4xl" data-id="{{ part }}">{{ text.text }}</span>
                        {% endfor %}
                        {% endwith %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
        </div>
    </section>
</div>