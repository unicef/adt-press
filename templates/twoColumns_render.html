{% set cover_bg_color = "#ffffff" %}
{% if section.section_type.name == "front_cover" %}
    {% for row in rows %}
        {% for col in row.columns %}
            {% if col.background_color != "#ffffff" %}
                {% set cover_bg_color = col.background_color %}
            {% endif %}
        {% endfor %}
    {% endfor %}
{% endif %}

<div class="container content mx-auto w-full min-h-screen px-8 py-8 flex items-center justify-center" id="content" style="background-color: {{ cover_bg_color }};">
    <section id="simple-main" role="article" data-section-type="{{ section.section_type.name }}" data-id="{{ section.section_id }}" {% if section.explanation_id %}data-eli5-id="{{ section.explanation_id }}"{% endif %}>
    {% for row in rows %}
        <div class="flex flex-col lg:flex-row px-8 items-center max-w-none w-full">
            {% for col in row.columns %}
                {% if row.columns|length == 1 %}
                    <!-- Single column layout for image-only or text-only pages -->
                    <div class="basis-full p-4 flex flex-col justify-center items-center">
                        {% for part in col.parts %}
                        {% if images[part] %}
                        <img class="mb-8 w-full rounded-lg" data-id="{{ part }}" style="max-height: 80vh; object-fit: contain;"></img>
                        {% elif texts[part] %}
                        <!-- Calculate total text length for single column text -->
                        {% set total_text_length = 0 %}
                        {% for text_part in col.parts %}
                            {% if texts[text_part] %}
                                {% set total_text_length = total_text_length + texts[text_part]|length %}
                            {% endif %}
                        {% endfor %}
                        
                        <!-- Use smaller text if total text length exceeds 300 characters -->
                        {% set text_size_class = "text-lg lg:text-xl" if total_text_length > 300 else "text-2xl lg:text-3xl" %}
                        
                        <p class="mb-8 {{ text_size_class }} leading-relaxed text-center font-normal max-w-4xl" data-id="{{ part }}">{{ texts[part] }}</p>
                        {% endif %}
                        {% endfor %}
                    </div>
                {% elif loop.index == 1 %}
                    <!-- Center column for images (span 3) - stacks above text on mobile -->
                    <div class="basis-full lg:basis-{{ col.span }}/5 p-4 lg:mr-4 flex flex-col justify-center items-center order-1 lg:order-none">
                        {% for part in col.parts %}
                        {% if images[part] %}
                        <img class="mb-8 w-full rounded-lg" data-id="{{ part }}" style="max-height: 80vh; object-fit: contain;"></img>
                        {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <!-- Right column for text (span 2) - stacks below image on mobile -->
                    <div class="basis-full lg:basis-{{ col.span }}/5 p-4 flex flex-col justify-center order-2 lg:order-none" style="color: {{ col.color }};">
                        {% if section.section_type.name == "front_cover" %}
                            <!-- Cover page styling: First text as title (h1), rest as smaller paragraphs -->
                            {% set text_parts = [] %}
                            {% for part in col.parts %}
                                {% if texts[part] %}
                                    {% set _ = text_parts.append(part) %}
                                {% endif %}
                            {% endfor %}
                            {% for part in col.parts %}
                                {% if texts[part] %}
                                    {% if part == text_parts[0] %}
                                        <h1 class="mb-8 text-4xl font-bold leading-tight text-center" data-id="{{ part }}">{{ texts[part] }}</h1>
                                    {% else %}
                                        <p class="mb-4 text-lg leading-relaxed text-center font-normal" data-id="{{ part }}">{{ texts[part] }}</p>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <!-- Regular page styling -->
                            {% set total_text_length = 0 %}
                            {% for part in col.parts %}
                                {% if texts[part] %}
                                    {% set total_text_length = total_text_length + texts[part]|length %}
                                {% endif %}
                            {% endfor %}
                            
                            <!-- Use smaller text if total text length exceeds 300 characters -->
                            {% set text_size_class = "text-lg lg:text-xl" if total_text_length > 300 else "text-2xl lg:text-3xl" %}
                            
                            {% for part in col.parts %}
                                {% if texts[part] %}
                                    <p class="mb-8 {{ text_size_class }} leading-relaxed text-left font-normal" data-id="{{ part }}">{{ texts[part] }}</p>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
    </section>
</div>